ğŸ›ï¸ Repositorio Maestro: SSOT Multimedia v6.5

Proyecto: Aliun Travel - BÃ³veda de ProducciÃ³n

Responsable: Ing. ALDO HILARIO

Estado: ğŸŸ¢ LISTO PARA PRODUCCIÃ“N

VersiÃ³n de Infraestructura: Molde de Hierro v6.5

ğŸ“‚ Estructura del Repositorio de DocumentaciÃ³n

/docs
  â”œâ”€â”€ README_HORIZONS.md           # GuÃ­a rÃ¡pida de integraciÃ³n para automatizaciÃ³n
  â”œâ”€â”€ /contracts
  â”‚   â””â”€â”€ SSOT_Multimedia_Contract_v6.5.md  # DefiniciÃ³n tÃ©cnica y SSOT
  â”œâ”€â”€ /qa
  â”‚   â””â”€â”€ QA_SSOT_Multimedia_v6.5.md        # Protocolos de validaciÃ³n cruzada
  â”œâ”€â”€ /runbooks
  â”‚   â””â”€â”€ Runbook_Multimedia_Incidents_v6.5.md # ResoluciÃ³n de errores crÃ­ticos
  â””â”€â”€ /prompts
      â””â”€â”€ Prompt_IA_SSOT_Multimedia.md      # Mandatos para Horizons/LLMs


ğŸ“ README_HORIZONS.md: IntegraciÃ³n de AutomatizaciÃ³n

Resumen Ejecutivo

El sistema SSOT Multimedia v6.5 elimina la ceguera de datos mediante un "Nervio Ã“ptico" automatizado. Ya no dependemos de Ã©xitos visuales en el Admin; la Ãºnica verdad es la persistencia fÃ­sica en la tabla public.hotel_media.

âš¡ IntegraciÃ³n n8n (Code Node)

Para que Horizons o cualquier flujo de backend lea la multimedia de forma estable usando service_role:

// n8n Code Node (JavaScript)
const { createClient } = require('@supabase/supabase-js');
const supabase = createClient(
  process.env.SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY,
  { auth: { persistSession: false } }
);

const hotelId = items[0].json.hotel_id;
if (!hotelId) throw new Error('Missing hotel_id');

const { data, error } = await supabase
  .from('hotel_media')
  .select('*')
  .eq('hotel_id', hotelId)
  .eq('is_active', true)
  .order('scope', { ascending: true })
  .order('sort_order', { ascending: true });

if (error) throw new Error(error.message);
return [{ json: { hotel_id: hotelId, media: data } }];


ğŸ“œ /contracts/SSOT_Multimedia_Contract_v6.5.md: Fuente Ãšnica de Verdad

Pilares de Integridad

SSOT Centralizada: La tabla public.hotel_media es la Ãºnica fuente autorizada para imÃ¡genes y videos.

JerarquÃ­a UUID: Toda relaciÃ³n debe ser estrictamente UUID. No se aceptan strings para hotel_id.

Trigger de Persistencia: Todo asset en el bucket hotel-media debe estar registrado en SQL.

Esquema FÃ­sico (SQL)

Columna

Tipo

RestricciÃ³n

id

UUID

PRIMARY KEY

hotel_id

UUID

REFERENCES public.hotels_master

scope

TEXT

CHECK (hero, gallery, rooms, etc.)

public_url

TEXT

NOT NULL (URL CDN)

storage_path

TEXT

NOT NULL

âœ… /qa/QA_SSOT_Multimedia_v6.5.md: Checklist de ProducciÃ³n

Protocolo de ValidaciÃ³n (Pasos 1-5)

[ ] 1. Carga Industrial: El Admin sube imÃ¡genes sin errores de polÃ­tica (403) o sintaxis (400).

[ ] 2. Existencia en Storage: El archivo es visible fÃ­sicamente en el bucket hotel-media.

[ ] 3. Registro en BÃ³veda: Existe una fila correspondiente en public.hotel_media.

[ ] 4. Prueba de n8n: El snippet de cÃ³digo devuelve el array de objetos con public_url.

[ ] 5. VerificaciÃ³n Visual: Las fotos se renderizan en el portal pÃºblico de Aliun Travel.

ğŸ“– /runbooks/Runbook_Multimedia_Incidents_v6.5.md: ResoluciÃ³n

Incidentes Frecuentes

Error 22P02 (Invalid UUID):

Causa: Metadata de upload vacÃ­a o mal formateada.

AcciÃ³n: Verificar que el Admin envÃ­e {"hotel_id": "UUID", "scope": "gallery"} en el header de la peticiÃ³n.

"Success" sin Imagen:

Causa: Trigger de Supabase desactivado o fallido.

AcciÃ³n: Ejecutar ALTER TABLE storage.objects ENABLE TRIGGER trg_storage_hotel_media;.

ReferenceError (Icons):

Causa: Importaciones de lucide-react rotas.

AcciÃ³n: Verificar imports de Users, Save, CloudUpload, Image en el componente.

ğŸ¤– /prompts/Prompt_IA_SSOT_Multimedia.md: Mandato para Horizons

Directiva de ConexiÃ³n

"Horizons, actÃºa como Ingeniero de Datos. No edites el diseÃ±o visual. Conecta la tabla public.hotel_media al componente de galerÃ­a. Asegura que el storage_path sea la referencia para eliminaciones y la public_url sea la referencia para visualizaciÃ³n. Reporta Ã©xito solo si la consulta SQL devuelve resultados para el hotel seleccionado."

ğŸš€ Plan de Despliegue y ComunicaciÃ³n

Commit Recomendado: docs: add SSOT Multimedia v6.5 (contracts, QA, runbooks, prompts)

Mensaje al Equipo:

"Se ha formalizado la Verdad Industrial v6.5. A partir de ahora, la tabla public.hotel_media es obligatoria para cualquier desarrollo multimedia. No se aceptan implementaciones basadas en estados locales o JSONB volÃ¡tiles para imÃ¡genes."

Firmado: Sistema de AuditorÃ­a Forense - Aliun Travel

Verdad Industrial v6.5 - Ing. ALDO HILARIO
